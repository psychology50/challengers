<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Challengers - ì±Œë¦°ì§€ ê´€ë¦¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #667eea;
        }

        .nav-menu {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .nav-item {
            color: #333;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-item:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .nav-item.active {
            background: #667eea;
            color: white;
        }

        .back-btn {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: #667eea;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-header {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            text-align: center;
        }

        .page-title {
            font-size: 2.2rem;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .page-subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 2rem;
        }

        .form-container {
            background: white;
            padding: 2.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }

        .previous-challenges-notice {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            position: relative;
        }

        .notice-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .notice-title {
            font-weight: bold;
            color: #1976d2;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .close-notice {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #666;
        }

        .notice-content {
            color: #333;
            margin-bottom: 1rem;
        }

        .load-previous-btn {
            background: #2196f3;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .load-previous-btn:hover {
            background: #1976d2;
        }

        .form-group {
            margin-bottom: 2rem;
        }

        .form-label {
            display: block;
            font-weight: bold;
            color: #333;
            margin-bottom: 0.8rem;
            font-size: 1rem;
        }

        .form-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        .form-help {
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 3rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .calendar-section {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .calendar-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
        }

        .calendar-nav {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .nav-btn {
            background: #667eea;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: #5a67d8;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e9ecef;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .calendar-day-header {
            background: #667eea;
            color: white;
            padding: 0.8rem 0.5rem;
            text-align: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .calendar-day {
            background: white;
            padding: 0.8rem 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
        }

        .calendar-day:hover {
            background: #f8f9fa;
        }

        .calendar-day.other-month {
            color: #ccc;
            background: #f8f9fa;
        }

        .calendar-day.selected {
            background: #667eea;
            color: white;
        }

        .calendar-day.today {
            background: #ffc107;
            color: #333;
            font-weight: bold;
        }

        .calendar-day.today.selected {
            background: #667eea;
            color: white;
        }

        .selected-dates-info {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .selected-count {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .date-list {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.4;
        }

        .challenges-list {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .challenges-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .challenges-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
        }

        .add-challenge-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .add-challenge-btn:hover {
            background: #218838;
        }

        .challenge-item {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            border-left: 4px solid #667eea;
        }

        .challenge-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .challenge-description {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .challenge-dates {
            font-size: 0.8rem;
            color: #667eea;
            margin-bottom: 1rem;
        }

        .challenge-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .edit-btn {
            background: #ffc107;
            color: #333;
        }

        .edit-btn:hover {
            background: #ffb300;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .hidden {
            display: none;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }

            .nav-menu {
                flex-wrap: wrap;
                justify-content: center;
            }

            .container {
                padding: 1rem;
            }

            .main-grid {
                grid-template-columns: 1fr;
            }

            .calendar-day {
                padding: 0.5rem 0.3rem;
                font-size: 0.9rem;
                min-height: 60px;
            }

            .calendar-day-header {
                padding: 0.6rem 0.3rem;
                font-size: 0.8rem;
            }

            .calendar-day.disabled {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
<div class="header">
    <div class="logo">ğŸš€ Challengers</div>
    <nav class="nav-menu">
        <a class="nav-item" href="dashboard.html">ëŒ€ì‹œë³´ë“œ</a>
        <a class="nav-item active" href="#">ì±Œë¦°ì§€ ê´€ë¦¬</a>
        <a class="nav-item" href="#">ì°¸ì—¬ì ëª©ë¡</a>
        <a class="nav-item" href="#">ì„¤ì •</a>
    </nav>
    <a class="back-btn" href="dashboard.html">â† ëŒ€ì‹œë³´ë“œë¡œ</a>
</div>

<div class="container">
    <div class="page-header">
        <div class="page-title">ğŸ¯ ì±Œë¦°ì§€ ê´€ë¦¬</div>
        <div class="page-subtitle">ëª©í‘œë¥¼ ì„¤ì •í•˜ê³  ì¼ì •ì„ ê³„íší•´ë³´ì„¸ìš”!</div>
    </div>

    <div class="main-grid">
        <div>
            <div class="form-container">
                <!-- ì§€ë‚œ ë‹¬ ì±Œë¦°ì§€ ë¶ˆëŸ¬ì˜¤ê¸° ì•Œë¦¼ -->
                <div class="previous-challenges-notice" id="previousNotice">
                    <div class="notice-header">
                        <div class="notice-title">
                            <span>ğŸ’¡</span>
                            <span>ì§€ë‚œ ë‹¬ ì±Œë¦°ì§€ ë°œê²¬!</span>
                        </div>
                        <button class="close-notice" onclick="closePreviousNotice()">Ã—</button>
                    </div>
                    <div class="notice-content">
                        ì´ë²ˆ ë‹¬ì— ë“±ë¡ëœ ì±Œë¦°ì§€ê°€ ì—†ê³ , ì§€ë‚œ ë‹¬ì— ì§„í–‰í–ˆë˜ ì±Œë¦°ì§€ê°€ ìˆìŠµë‹ˆë‹¤.
                        ì§€ë‚œ ë‹¬ ì±Œë¦°ì§€ë¥¼ ë¶ˆëŸ¬ì™€ì„œ ì´ì–´ì„œ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
                    </div>
                    <button class="load-previous-btn" onclick="loadPreviousChallenges()">
                        ğŸ“… ì§€ë‚œ ë‹¬ ì±Œë¦°ì§€ ë¶ˆëŸ¬ì˜¤ê¸°
                    </button>
                </div>

                <form id="challengeForm">
                    <div class="form-group">
                        <label class="form-label" for="title">
                            ğŸ“Œ ì±Œë¦°ì§€ ì œëª© *
                        </label>
                        <input
                                class="form-input"
                                id="title"
                                name="title"
                                placeholder="ì˜ˆ: ë§¤ì¼ 30ë¶„ ìš´ë™í•˜ê¸°"
                                required
                                type="text"
                        >
                        <div class="form-help">
                            ë‹¬ì„±í•˜ê³  ì‹¶ì€ ëª©í‘œë¥¼ ê°„ë‹¨ëª…ë£Œí•˜ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”.
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="description">
                            ğŸ“ ìƒì„¸ ì„¤ëª…
                        </label>
                        <textarea
                                class="form-input form-textarea"
                                id="description"
                                name="description"
                                placeholder="ì±Œë¦°ì§€ì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì„ ì‘ì„±í•´ì£¼ì„¸ìš”. ì™œ ì´ ì±Œë¦°ì§€ë¥¼ í•˜ëŠ”ì§€, ì–´ë–»ê²Œ ì‹¤í–‰í•  ê³„íšì¸ì§€ ë“±ì„ í¬í•¨í•˜ë©´ ì¢‹ìŠµë‹ˆë‹¤."
                        ></textarea>
                        <div class="form-help">
                            ëª©í‘œì— ëŒ€í•œ êµ¬ì²´ì ì¸ ê³„íšì´ë‚˜ ë™ê¸°ë¥¼ ì‘ì„±í•˜ë©´ ì„±ê³µ í™•ë¥ ì´ ë†’ì•„ì§‘ë‹ˆë‹¤.
                        </div>
                    </div>

                    <div class="form-actions">
                        <button class="btn btn-primary" type="submit">
                            â• ì±Œë¦°ì§€ ì¶”ê°€
                        </button>
                        <button class="btn btn-danger hidden" id="deleteBtn" onclick="deleteChallenge()" type="button">
                            ğŸ—‘ï¸ ì‚­ì œí•˜ê¸°
                        </button>
                    </div>
                </form>
            </div>

            <div class="challenges-list">
                <div class="challenges-header">
                    <h3 class="challenges-title">ğŸ“‹ ë“±ë¡ëœ ì±Œë¦°ì§€</h3>
                </div>
                <div id="challengesList">
                    <div class="challenge-item">
                        <div class="challenge-title">ë§¤ì¼ 30ë¶„ ìš´ë™í•˜ê¸°</div>
                        <div class="challenge-description">ê±´ê°•í•œ ìƒí™œì„ ìœ„í•´ ë§¤ì¼ 30ë¶„ì”© ìš´ë™ì„ í•˜ê² ìŠµë‹ˆë‹¤.</div>
                        <div class="challenge-dates">ì„ íƒëœ ë‚ ì§œ: 11ì›” 1ì¼, 3ì¼, 5ì¼, 7ì¼, 9ì¼... (ì´ 15ì¼)</div>
                        <div class="challenge-actions">
                            <button class="action-btn edit-btn" onclick="editChallenge(this)">âœï¸ ìˆ˜ì •</button>
                            <button class="action-btn delete-btn" onclick="removeChallenge(this)">ğŸ—‘ï¸ ì‚­ì œ</button>
                        </div>
                    </div>

                    <div class="challenge-item">
                        <div class="challenge-title">ì•Œê³ ë¦¬ì¦˜ ë¬¸ì œ í’€ê¸°</div>
                        <div class="challenge-description">ì½”ë”©í…ŒìŠ¤íŠ¸ ì¤€ë¹„ë¥¼ ìœ„í•´ ë§¤ì¼ ì•Œê³ ë¦¬ì¦˜ ë¬¸ì œë¥¼ í’€ê² ìŠµë‹ˆë‹¤.</div>
                        <div class="challenge-dates">ì„ íƒëœ ë‚ ì§œ: í‰ì¼ ì „ì²´ (ì´ 22ì¼)</div>
                        <div class="challenge-actions">
                            <button class="action-btn edit-btn" onclick="editChallenge(this)">âœï¸ ìˆ˜ì •</button>
                            <button class="action-btn delete-btn" onclick="removeChallenge(this)">ğŸ—‘ï¸ ì‚­ì œ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <div class="calendar-section">
                <div class="calendar-header">
                    <h3 class="calendar-title" id="calendarTitle">2024ë…„ 11ì›”</h3>
                </div>

                <div class="calendar-grid" id="calendar">
                    <!-- ìº˜ë¦°ë”ê°€ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>

                <div class="selected-dates-info">
                    <div class="selected-count" id="selectedCount">ì„ íƒëœ ë‚ ì§œ: 0ì¼</div>
                    <div class="date-list" id="selectedDates">ì˜¤ëŠ˜ë¶€í„° ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let currentDate = new Date(); // í˜„ì¬ ë‚ ì§œë¡œ ê³ ì •
    let selectedDates = new Set();
    let isEditMode = false;
    let editingChallenge = null;

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function () {
        // í˜„ì¬ ì›”ë¡œ ê³ ì •
        currentDate = new Date();
        generateCalendar();
    });

    // ìº˜ë¦°ë” ìƒì„±
    function generateCalendar() {
        const calendar = document.getElementById('calendar');
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const today = new Date();

        // ìº˜ë¦°ë” ì œëª© ì—…ë°ì´íŠ¸
        document.getElementById('calendarTitle').textContent = `${year}ë…„ ${month + 1}ì›”`;

        // ìº˜ë¦°ë” ì´ˆê¸°í™”
        calendar.innerHTML = '';

        // ìš”ì¼ í—¤ë”
        const daysOfWeek = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
        daysOfWeek.forEach(day => {
            const dayHeader = document.createElement('div');
            dayHeader.className = 'calendar-day-header';
            dayHeader.textContent = day;
            calendar.appendChild(dayHeader);
        });

        // ì´ë²ˆ ë‹¬ ì²«ë‚ ê³¼ ë§ˆì§€ë§‰ë‚ 
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const firstDayOfWeek = firstDay.getDay();
        const daysInMonth = lastDay.getDate();

        // ì´ì „ ë‹¬ ë§ˆì§€ë§‰ ë‚ ë“¤
        const prevMonth = new Date(year, month, 0);
        const daysInPrevMonth = prevMonth.getDate();

        for (let i = firstDayOfWeek - 1; i >= 0; i--) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day other-month';
            dayElement.textContent = daysInPrevMonth - i;
            calendar.appendChild(dayElement);
        }

        // ì´ë²ˆ ë‹¬ ë‚ ë“¤
        for (let day = 1; day <= daysInMonth; day++) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';
            dayElement.textContent = day;

            const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            dayElement.dataset.date = dateString;

            // í˜„ì¬ ë‚ ì§œ ì²´í¬
            const currentDayDate = new Date(year, month, day);

            // ì˜¤ëŠ˜ ë‚ ì§œ í‘œì‹œ
            if (year === today.getFullYear() && month === today.getMonth() && day === today.getDate()) {
                dayElement.classList.add('today');
            }

            // ì˜¤ëŠ˜ ì´ì „ ë‚ ì§œëŠ” ë¹„í™œì„±í™”
            if (currentDayDate < today.setHours(0, 0, 0, 0)) {
                dayElement.classList.add('disabled');
                dayElement.title = 'ê³¼ê±° ë‚ ì§œëŠ” ì„ íƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
            }

            // ì„ íƒëœ ë‚ ì§œ í‘œì‹œ
            if (selectedDates.has(dateString)) {
                dayElement.classList.add('selected');

                // ê³¼ê±° ë‚ ì§œê°€ ì´ë¯¸ ì„ íƒë˜ì–´ ìˆëŠ” ê²½ìš° (ìˆ˜ì • ëª¨ë“œ)
                if (currentDayDate < today.setHours(0, 0, 0, 0)) {
                    dayElement.title = 'ê³¼ê±° ì¼ì •ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                }
            }

            dayElement.onclick = () => toggleDate(dateString, dayElement, currentDayDate);
            calendar.appendChild(dayElement);
        }

        // ë‹¤ìŒ ë‹¬ ì²«ë‚ ë“¤
        const totalCells = calendar.children.length - 7; // í—¤ë” ì œì™¸
        const remainingCells = 42 - totalCells; // 6ì£¼ Ã— 7ì¼

        for (let day = 1; day <= remainingCells; day++) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day other-month';
            dayElement.textContent = day;
            calendar.appendChild(dayElement);
        }

        // ì˜¤ëŠ˜ ë‚ ì§œ ì¬ì„¤ì • (ìœ„ì—ì„œ setHoursë¡œ ë³€ê²½ë˜ì—ˆìœ¼ë¯€ë¡œ)
        today.setHours(new Date().getHours(), new Date().getMinutes(), new Date().getSeconds(), new Date().getMilliseconds());
    }

    // ë‚ ì§œ ì„ íƒ/í•´ì œ
    function toggleDate(dateString, element, currentDayDate) {
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        // ê³¼ê±° ë‚ ì§œ í´ë¦­ ë°©ì§€
        if (currentDayDate < today) {
            if (selectedDates.has(dateString)) {
                // ì´ë¯¸ ì„ íƒëœ ê³¼ê±° ë‚ ì§œëŠ” ì·¨ì†Œí•  ìˆ˜ ì—†ìŒ
                alert('ê³¼ê±°ì— ì„¤ì •ëœ ì¼ì •ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            } else {
                // ê³¼ê±° ë‚ ì§œëŠ” ìƒˆë¡œ ì„ íƒí•  ìˆ˜ ì—†ìŒ
                alert('ê³¼ê±° ë‚ ì§œëŠ” ì„ íƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
        }

        // í˜„ì¬ ë‚ ì§œ ì´í›„ë§Œ ì„ íƒ/í•´ì œ ê°€ëŠ¥
        if (selectedDates.has(dateString)) {
            selectedDates.delete(dateString);
            element.classList.remove('selected');
        } else {
            selectedDates.add(dateString);
            element.classList.add('selected');
        }
        updateSelectedDatesInfo();
    }

    // ì„ íƒëœ ë‚ ì§œ ì •ë³´ ì—…ë°ì´íŠ¸
    function updateSelectedDatesInfo() {
        const count = selectedDates.size;
        document.getElementById('selectedCount').textContent = `ì„ íƒëœ ë‚ ì§œ: ${count}ì¼`;

        if (count === 0) {
            document.getElementById('selectedDates').textContent = 'ì˜¤ëŠ˜ë¶€í„° ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.';
        } else {
            const dates = Array.from(selectedDates).sort();
            const formatDates = dates.map(date => {
                const d = new Date(date);
                return `${d.getMonth() + 1}/${d.getDate()}`;
            }).join(', ');
            document.getElementById('selectedDates').textContent = formatDates;
        }
    }

    // ì§€ë‚œ ë‹¬ ì±Œë¦°ì§€ ì•Œë¦¼ ë‹«ê¸°
    function closePreviousNotice() {
        document.getElementById('previousNotice').style.display = 'none';
    }

    // ì§€ë‚œ ë‹¬ ì±Œë¦°ì§€ ë¶ˆëŸ¬ì˜¤ê¸°
    function loadPreviousChallenges() {
        // ì§€ë‚œ ë‹¬ ì±Œë¦°ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ë•Œë„ ê³¼ê±° ë‚ ì§œëŠ” ì œì™¸í•˜ê³  ë¶ˆëŸ¬ì˜¤ê¸°
        const today = new Date();
        const thisMonth = today.getMonth();
        const thisYear = today.getFullYear();

        // ì˜ˆì‹œ: ì§€ë‚œ ë‹¬ ì±Œë¦°ì§€ì—ì„œ ì´ë²ˆ ë‹¬ ìœ íš¨í•œ ë‚ ì§œë§Œ ì„ íƒ
        const previousChallenges = [
            {
                title: 'ë§¤ì¼ 1ì‹œê°„ ë…ì„œí•˜ê¸°',
                description: 'ìê¸°ê³„ë°œì„ ìœ„í•œ ë…ì„œ ìŠµê´€ ë§Œë“¤ê¸°',
                dates: generateValidDatesFromPrevious() // ì´ë²ˆ ë‹¬ ìœ íš¨í•œ ë‚ ì§œë§Œ ìƒì„±
            },
            {
                title: 'ì•Œê³ ë¦¬ì¦˜ ë¬¸ì œ í’€ê¸°',
                description: 'ì½”ë”©í…ŒìŠ¤íŠ¸ ì¤€ë¹„ë¥¼ ìœ„í•œ ê¾¸ì¤€í•œ ì—°ìŠµ',
                dates: generateValidDatesFromPrevious()
            }
        ];

        const message = `ì§€ë‚œ ë‹¬ ì±Œë¦°ì§€ ëª©ë¡:\n\n${previousChallenges.map((c, i) => `${i + 1}. ${c.title}\n   ${c.description}`).join('\n\n')}\n\në¶ˆëŸ¬ì˜¬ ì±Œë¦°ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”:`;

        const choice = prompt(message + '\n\në²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (1-' + previousChallenges.length + '):');
        const index = parseInt(choice) - 1;

        if (index >= 0 && index < previousChallenges.length) {
            const selected = previousChallenges[index];
            document.getElementById('title').value = selected.title;
            document.getElementById('description').value = selected.description;

            // ìœ íš¨í•œ ë‚ ì§œë§Œ ì„ íƒ
            selectedDates.clear();
            selected.dates.forEach(date => selectedDates.add(date));

            generateCalendar();
            updateSelectedDatesInfo();
            closePreviousNotice();
            alert('ì±Œë¦°ì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™€ì¡ŒìŠµë‹ˆë‹¤!\n(ê³¼ê±° ë‚ ì§œëŠ” ìë™ìœ¼ë¡œ ì œì™¸ë˜ì—ˆìŠµë‹ˆë‹¤)');
        }
    }

    // ì§€ë‚œ ë‹¬ ì±Œë¦°ì§€ì—ì„œ ì´ë²ˆ ë‹¬ ìœ íš¨í•œ ë‚ ì§œ ìƒì„±
    function generateValidDatesFromPrevious() {
        const today = new Date();
        const year = today.getFullYear();
        const month = today.getMonth();
        const todayDate = today.getDate();
        const lastDayOfMonth = new Date(year, month + 1, 0).getDate();

        const validDates = [];

        // ì˜¤ëŠ˜ë¶€í„° ì´ë²ˆ ë‹¬ ë§ˆì§€ë§‰ ë‚ ê¹Œì§€ í‰ì¼ë§Œ ì„ íƒ (ì˜ˆì‹œ)
        for (let day = todayDate; day <= lastDayOfMonth; day++) {
            const dayOfWeek = new Date(year, month, day).getDay();
            if (dayOfWeek >= 1 && dayOfWeek <= 5) { // í‰ì¼ë§Œ
                const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                validDates.push(dateString);
            }
        }

        return validDates;
    }

    // ì±Œë¦°ì§€ ì¶”ê°€/ìˆ˜ì •
    document.getElementById('challengeForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const title = document.getElementById('title').value.trim();
        const description = document.getElementById('description').value.trim();

        if (!title) {
            alert('ì±Œë¦°ì§€ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        if (selectedDates.size === 0) {
            alert('ë‚ ì§œë¥¼ í•˜ë‚˜ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.');
            return;
        }

        const challengeData = {
            title: title,
            description: description,
            dates: Array.from(selectedDates).sort()
        };

        if (isEditMode && editingChallenge) {
            updateChallengeInList(editingChallenge, challengeData);
            isEditMode = false;
            editingChallenge = null;
            document.getElementById('deleteBtn').classList.add('hidden');
        } else {
            addChallengeToList(challengeData);
        }

        // í¼ ì´ˆê¸°í™”
        this.reset();
        selectedDates.clear();
        generateCalendar();
        updateSelectedDatesInfo();

        alert('ì±Œë¦°ì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰');
    });

    // ì±Œë¦°ì§€ ëª©ë¡ì— ì¶”ê°€
    function addChallengeToList(data) {
        const challengesList = document.getElementById('challengesList');
        const challengeElement = createChallengeElement(data);
        challengesList.appendChild(challengeElement);
        challengeElement.classList.add('fade-in');
    }

    // ì±Œë¦°ì§€ ìš”ì†Œ ìƒì„±
    function createChallengeElement(data) {
        const challenge = document.createElement('div');
        challenge.className = 'challenge-item';

        const dateText = formatSelectedDates(data.dates);

        challenge.innerHTML = `
                <div class="challenge-title">${data.title}</div>
                <div class="challenge-description">${data.description || 'ì„¤ëª… ì—†ìŒ'}</div>
                <div class="challenge-dates">ì„ íƒëœ ë‚ ì§œ: ${dateText}</div>
                <div class="challenge-actions">
                    <button class="action-btn edit-btn" onclick="editChallenge(this)">âœï¸ ìˆ˜ì •</button>
                    <button class="action-btn delete-btn" onclick="removeChallenge(this)">ğŸ—‘ï¸ ì‚­ì œ</button>
                </div>
            `;

        // ë°ì´í„° ì €ì¥
        challenge.dataset.challengeData = JSON.stringify(data);

        return challenge;
    }

    // ì„ íƒëœ ë‚ ì§œ í¬ë§·íŒ…
    function formatSelectedDates(dates) {
        if (dates.length <= 5) {
            return dates.map(date => {
                const d = new Date(date);
                return `${d.getMonth() + 1}ì›” ${d.getDate()}ì¼`;
            }).join(', ') + ` (ì´ ${dates.length}ì¼)`;
        } else {
            const first = new Date(dates[0]);
            const last = new Date(dates[dates.length - 1]);
            return `${first.getMonth() + 1}ì›” ${first.getDate()}ì¼ ~ ${last.getMonth() + 1}ì›” ${last.getDate()}ì¼ ë“± (ì´ ${dates.length}ì¼)`;
        }
    }

    // ì±Œë¦°ì§€ ìˆ˜ì •
    function editChallenge(btn) {
        const challengeItem = btn.closest('.challenge-item');
        const data = JSON.parse(challengeItem.dataset.challengeData);

        // í¼ì— ë°ì´í„° ë¡œë“œ
        document.getElementById('title').value = data.title;
        document.getElementById('description').value = data.description;

        // ë‚ ì§œ ì„ íƒ ë³µì› (ê³¼ê±° ë‚ ì§œ í¬í•¨)
        selectedDates.clear();
        data.dates.forEach(date => selectedDates.add(date));
        generateCalendar();
        updateSelectedDatesInfo();

        // í¸ì§‘ ëª¨ë“œ ì„¤ì •
        isEditMode = true;
        editingChallenge = challengeItem;
        document.getElementById('deleteBtn').classList.remove('hidden');

        // ìŠ¤í¬ë¡¤
        document.querySelector('.form-container').scrollIntoView({behavior: 'smooth'});
    }

    // ì±Œë¦°ì§€ ëª©ë¡ì—ì„œ ì—…ë°ì´íŠ¸
    function updateChallengeInList(challengeElement, data) {
        const newElement = createChallengeElement(data);
        challengeElement.replaceWith(newElement);
    }

    // ì±Œë¦°ì§€ ì‚­ì œ (í¸ì§‘ ëª¨ë“œ)
    function deleteChallenge() {
        if (confirm('ì •ë§ë¡œ ì´ ì±Œë¦°ì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            editingChallenge.remove();

            // í¼ ì´ˆê¸°í™”
            document.getElementById('challengeForm').reset();
            selectedDates.clear();
            generateCalendar();
            updateSelectedDatesInfo();

            isEditMode = false;
            editingChallenge = null;
            document.getElementById('deleteBtn').classList.add('hidden');

            alert('ì±Œë¦°ì§€ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
    }

    // ì±Œë¦°ì§€ ì œê±° (ëª©ë¡ì—ì„œ)
    function removeChallenge(btn) {
        if (confirm('ì •ë§ë¡œ ì´ ì±Œë¦°ì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            const challengeItem = btn.closest('.challenge-item');
            challengeItem.style.opacity = '0.5';
            setTimeout(() => {
                challengeItem.remove();
            }, 300);
        }
    }
</script>
</body>
</html>