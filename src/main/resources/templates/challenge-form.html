<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Challengers - 챌린지 관리</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #667eea;
        }

        .nav-menu {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .nav-item {
            color: #333;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-item:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .nav-item.active {
            background: #667eea;
            color: white;
        }

        .back-btn {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: #667eea;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-header {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            text-align: center;
        }

        .page-title {
            font-size: 2.2rem;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .page-subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 2rem;
        }

        .form-container {
            background: white;
            padding: 2.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }

        .previous-challenges-notice {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            position: relative;
        }

        .notice-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .notice-title {
            font-weight: bold;
            color: #1976d2;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .close-notice {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #666;
        }

        .notice-content {
            color: #333;
            margin-bottom: 1rem;
        }

        .load-previous-btn {
            background: #2196f3;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .load-previous-btn:hover {
            background: #1976d2;
        }

        .form-group {
            margin-bottom: 2rem;
        }

        .form-label {
            display: block;
            font-weight: bold;
            color: #333;
            margin-bottom: 0.8rem;
            font-size: 1rem;
        }

        .form-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        .form-help {
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 3rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .calendar-section {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .calendar-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
        }

        .calendar-nav {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .nav-btn {
            background: #667eea;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: #5a67d8;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e9ecef;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .calendar-day-header {
            background: #667eea;
            color: white;
            padding: 0.8rem 0.5rem;
            text-align: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .calendar-day {
            background: white;
            padding: 0.8rem 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
        }

        .calendar-day:hover {
            background: #f8f9fa;
        }

        .calendar-day.other-month {
            color: #ccc;
            background: #f8f9fa;
        }

        .calendar-day.selected {
            background: #667eea;
            color: white;
        }

        .calendar-day.today {
            background: #ffc107;
            color: #333;
            font-weight: bold;
        }

        .calendar-day.today.selected {
            background: #667eea;
            color: white;
        }

        .selected-dates-info {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .selected-count {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .date-list {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.4;
        }

        .challenges-list {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .challenges-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .challenges-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
        }

        .add-challenge-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .add-challenge-btn:hover {
            background: #218838;
        }

        .challenge-item {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            border-left: 4px solid #667eea;
        }

        .challenge-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .challenge-description {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .challenge-dates {
            font-size: 0.8rem;
            color: #667eea;
            margin-bottom: 1rem;
        }

        .challenge-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .edit-btn {
            background: #ffc107;
            color: #333;
        }

        .edit-btn:hover {
            background: #ffb300;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .hidden {
            display: none;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }

            .nav-menu {
                flex-wrap: wrap;
                justify-content: center;
            }

            .container {
                padding: 1rem;
            }

            .main-grid {
                grid-template-columns: 1fr;
            }

            .calendar-day {
                padding: 0.5rem 0.3rem;
                font-size: 0.9rem;
                min-height: 60px;
            }

            .calendar-day-header {
                padding: 0.6rem 0.3rem;
                font-size: 0.8rem;
            }

            .calendar-day.disabled {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
<div class="header">
    <div class="logo">🚀 Challengers</div>
    <nav class="nav-menu">
        <a class="nav-item" href="dashboard.html">대시보드</a>
        <a class="nav-item active" href="#">챌린지 관리</a>
        <a class="nav-item" href="#">참여자 목록</a>
        <a class="nav-item" href="#">설정</a>
    </nav>
    <a class="back-btn" href="dashboard.html">← 대시보드로</a>
</div>

<div class="container">
    <div class="page-header">
        <div class="page-title">🎯 챌린지 관리</div>
        <div class="page-subtitle">목표를 설정하고 일정을 계획해보세요!</div>
    </div>

    <div class="main-grid">
        <div>
            <div class="form-container">
                <!-- 지난 달 챌린지 불러오기 알림 -->
                <div class="previous-challenges-notice" id="previousNotice">
                    <div class="notice-header">
                        <div class="notice-title">
                            <span>💡</span>
                            <span>지난 달 챌린지 발견!</span>
                        </div>
                        <button class="close-notice" onclick="closePreviousNotice()">×</button>
                    </div>
                    <div class="notice-content">
                        이번 달에 등록된 챌린지가 없고, 지난 달에 진행했던 챌린지가 있습니다.
                        지난 달 챌린지를 불러와서 이어서 진행하시겠습니까?
                    </div>
                    <button class="load-previous-btn" onclick="loadPreviousChallenges()">
                        📅 지난 달 챌린지 불러오기
                    </button>
                </div>

                <form id="challengeForm">
                    <div class="form-group">
                        <label class="form-label" for="title">
                            📌 챌린지 제목 *
                        </label>
                        <input
                                class="form-input"
                                id="title"
                                name="title"
                                placeholder="예: 매일 30분 운동하기"
                                required
                                type="text"
                        >
                        <div class="form-help">
                            달성하고 싶은 목표를 간단명료하게 작성해주세요.
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="description">
                            📝 상세 설명
                        </label>
                        <textarea
                                class="form-input form-textarea"
                                id="description"
                                name="description"
                                placeholder="챌린지에 대한 자세한 설명을 작성해주세요. 왜 이 챌린지를 하는지, 어떻게 실행할 계획인지 등을 포함하면 좋습니다."
                        ></textarea>
                        <div class="form-help">
                            목표에 대한 구체적인 계획이나 동기를 작성하면 성공 확률이 높아집니다.
                        </div>
                    </div>

                    <div class="form-actions">
                        <button class="btn btn-primary" type="submit">
                            ➕ 챌린지 추가
                        </button>
                        <button class="btn btn-danger hidden" id="deleteBtn" onclick="deleteChallenge()" type="button">
                            🗑️ 삭제하기
                        </button>
                    </div>
                </form>
            </div>

            <div class="challenges-list">
                <div class="challenges-header">
                    <h3 class="challenges-title">📋 등록된 챌린지</h3>
                </div>
                <div id="challengesList">
                    <div class="challenge-item">
                        <div class="challenge-title">매일 30분 운동하기</div>
                        <div class="challenge-description">건강한 생활을 위해 매일 30분씩 운동을 하겠습니다.</div>
                        <div class="challenge-dates">선택된 날짜: 11월 1일, 3일, 5일, 7일, 9일... (총 15일)</div>
                        <div class="challenge-actions">
                            <button class="action-btn edit-btn" onclick="editChallenge(this)">✏️ 수정</button>
                            <button class="action-btn delete-btn" onclick="removeChallenge(this)">🗑️ 삭제</button>
                        </div>
                    </div>

                    <div class="challenge-item">
                        <div class="challenge-title">알고리즘 문제 풀기</div>
                        <div class="challenge-description">코딩테스트 준비를 위해 매일 알고리즘 문제를 풀겠습니다.</div>
                        <div class="challenge-dates">선택된 날짜: 평일 전체 (총 22일)</div>
                        <div class="challenge-actions">
                            <button class="action-btn edit-btn" onclick="editChallenge(this)">✏️ 수정</button>
                            <button class="action-btn delete-btn" onclick="removeChallenge(this)">🗑️ 삭제</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <div class="calendar-section">
                <div class="calendar-header">
                    <h3 class="calendar-title" id="calendarTitle">2024년 11월</h3>
                </div>

                <div class="calendar-grid" id="calendar">
                    <!-- 캘린더가 여기에 생성됩니다 -->
                </div>

                <div class="selected-dates-info">
                    <div class="selected-count" id="selectedCount">선택된 날짜: 0일</div>
                    <div class="date-list" id="selectedDates">오늘부터 선택 가능합니다.</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let currentDate = new Date(); // 현재 날짜로 고정
    let selectedDates = new Set();
    let isEditMode = false;
    let editingChallenge = null;

    // 페이지 로드 시 초기화
    document.addEventListener('DOMContentLoaded', function () {
        // 현재 월로 고정
        currentDate = new Date();
        generateCalendar();
    });

    // 캘린더 생성
    function generateCalendar() {
        const calendar = document.getElementById('calendar');
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const today = new Date();

        // 캘린더 제목 업데이트
        document.getElementById('calendarTitle').textContent = `${year}년 ${month + 1}월`;

        // 캘린더 초기화
        calendar.innerHTML = '';

        // 요일 헤더
        const daysOfWeek = ['일', '월', '화', '수', '목', '금', '토'];
        daysOfWeek.forEach(day => {
            const dayHeader = document.createElement('div');
            dayHeader.className = 'calendar-day-header';
            dayHeader.textContent = day;
            calendar.appendChild(dayHeader);
        });

        // 이번 달 첫날과 마지막날
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const firstDayOfWeek = firstDay.getDay();
        const daysInMonth = lastDay.getDate();

        // 이전 달 마지막 날들
        const prevMonth = new Date(year, month, 0);
        const daysInPrevMonth = prevMonth.getDate();

        for (let i = firstDayOfWeek - 1; i >= 0; i--) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day other-month';
            dayElement.textContent = daysInPrevMonth - i;
            calendar.appendChild(dayElement);
        }

        // 이번 달 날들
        for (let day = 1; day <= daysInMonth; day++) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';
            dayElement.textContent = day;

            const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            dayElement.dataset.date = dateString;

            // 현재 날짜 체크
            const currentDayDate = new Date(year, month, day);

            // 오늘 날짜 표시
            if (year === today.getFullYear() && month === today.getMonth() && day === today.getDate()) {
                dayElement.classList.add('today');
            }

            // 오늘 이전 날짜는 비활성화
            if (currentDayDate < today.setHours(0, 0, 0, 0)) {
                dayElement.classList.add('disabled');
                dayElement.title = '과거 날짜는 선택할 수 없습니다';
            }

            // 선택된 날짜 표시
            if (selectedDates.has(dateString)) {
                dayElement.classList.add('selected');

                // 과거 날짜가 이미 선택되어 있는 경우 (수정 모드)
                if (currentDayDate < today.setHours(0, 0, 0, 0)) {
                    dayElement.title = '과거 일정은 취소할 수 없습니다';
                }
            }

            dayElement.onclick = () => toggleDate(dateString, dayElement, currentDayDate);
            calendar.appendChild(dayElement);
        }

        // 다음 달 첫날들
        const totalCells = calendar.children.length - 7; // 헤더 제외
        const remainingCells = 42 - totalCells; // 6주 × 7일

        for (let day = 1; day <= remainingCells; day++) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day other-month';
            dayElement.textContent = day;
            calendar.appendChild(dayElement);
        }

        // 오늘 날짜 재설정 (위에서 setHours로 변경되었으므로)
        today.setHours(new Date().getHours(), new Date().getMinutes(), new Date().getSeconds(), new Date().getMilliseconds());
    }

    // 날짜 선택/해제
    function toggleDate(dateString, element, currentDayDate) {
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        // 과거 날짜 클릭 방지
        if (currentDayDate < today) {
            if (selectedDates.has(dateString)) {
                // 이미 선택된 과거 날짜는 취소할 수 없음
                alert('과거에 설정된 일정은 취소할 수 없습니다.');
                return;
            } else {
                // 과거 날짜는 새로 선택할 수 없음
                alert('과거 날짜는 선택할 수 없습니다.');
                return;
            }
        }

        // 현재 날짜 이후만 선택/해제 가능
        if (selectedDates.has(dateString)) {
            selectedDates.delete(dateString);
            element.classList.remove('selected');
        } else {
            selectedDates.add(dateString);
            element.classList.add('selected');
        }
        updateSelectedDatesInfo();
    }

    // 선택된 날짜 정보 업데이트
    function updateSelectedDatesInfo() {
        const count = selectedDates.size;
        document.getElementById('selectedCount').textContent = `선택된 날짜: ${count}일`;

        if (count === 0) {
            document.getElementById('selectedDates').textContent = '오늘부터 선택 가능합니다.';
        } else {
            const dates = Array.from(selectedDates).sort();
            const formatDates = dates.map(date => {
                const d = new Date(date);
                return `${d.getMonth() + 1}/${d.getDate()}`;
            }).join(', ');
            document.getElementById('selectedDates').textContent = formatDates;
        }
    }

    // 지난 달 챌린지 알림 닫기
    function closePreviousNotice() {
        document.getElementById('previousNotice').style.display = 'none';
    }

    // 지난 달 챌린지 불러오기
    function loadPreviousChallenges() {
        // 지난 달 챌린지를 불러올 때도 과거 날짜는 제외하고 불러오기
        const today = new Date();
        const thisMonth = today.getMonth();
        const thisYear = today.getFullYear();

        // 예시: 지난 달 챌린지에서 이번 달 유효한 날짜만 선택
        const previousChallenges = [
            {
                title: '매일 1시간 독서하기',
                description: '자기계발을 위한 독서 습관 만들기',
                dates: generateValidDatesFromPrevious() // 이번 달 유효한 날짜만 생성
            },
            {
                title: '알고리즘 문제 풀기',
                description: '코딩테스트 준비를 위한 꾸준한 연습',
                dates: generateValidDatesFromPrevious()
            }
        ];

        const message = `지난 달 챌린지 목록:\n\n${previousChallenges.map((c, i) => `${i + 1}. ${c.title}\n   ${c.description}`).join('\n\n')}\n\n불러올 챌린지를 선택하세요:`;

        const choice = prompt(message + '\n\n번호를 입력하세요 (1-' + previousChallenges.length + '):');
        const index = parseInt(choice) - 1;

        if (index >= 0 && index < previousChallenges.length) {
            const selected = previousChallenges[index];
            document.getElementById('title').value = selected.title;
            document.getElementById('description').value = selected.description;

            // 유효한 날짜만 선택
            selectedDates.clear();
            selected.dates.forEach(date => selectedDates.add(date));

            generateCalendar();
            updateSelectedDatesInfo();
            closePreviousNotice();
            alert('챌린지가 성공적으로 불러와졌습니다!\n(과거 날짜는 자동으로 제외되었습니다)');
        }
    }

    // 지난 달 챌린지에서 이번 달 유효한 날짜 생성
    function generateValidDatesFromPrevious() {
        const today = new Date();
        const year = today.getFullYear();
        const month = today.getMonth();
        const todayDate = today.getDate();
        const lastDayOfMonth = new Date(year, month + 1, 0).getDate();

        const validDates = [];

        // 오늘부터 이번 달 마지막 날까지 평일만 선택 (예시)
        for (let day = todayDate; day <= lastDayOfMonth; day++) {
            const dayOfWeek = new Date(year, month, day).getDay();
            if (dayOfWeek >= 1 && dayOfWeek <= 5) { // 평일만
                const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                validDates.push(dateString);
            }
        }

        return validDates;
    }

    // 챌린지 추가/수정
    document.getElementById('challengeForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const title = document.getElementById('title').value.trim();
        const description = document.getElementById('description').value.trim();

        if (!title) {
            alert('챌린지 제목을 입력해주세요.');
            return;
        }

        if (selectedDates.size === 0) {
            alert('날짜를 하나 이상 선택해주세요.');
            return;
        }

        const challengeData = {
            title: title,
            description: description,
            dates: Array.from(selectedDates).sort()
        };

        if (isEditMode && editingChallenge) {
            updateChallengeInList(editingChallenge, challengeData);
            isEditMode = false;
            editingChallenge = null;
            document.getElementById('deleteBtn').classList.add('hidden');
        } else {
            addChallengeToList(challengeData);
        }

        // 폼 초기화
        this.reset();
        selectedDates.clear();
        generateCalendar();
        updateSelectedDatesInfo();

        alert('챌린지가 성공적으로 저장되었습니다! 🎉');
    });

    // 챌린지 목록에 추가
    function addChallengeToList(data) {
        const challengesList = document.getElementById('challengesList');
        const challengeElement = createChallengeElement(data);
        challengesList.appendChild(challengeElement);
        challengeElement.classList.add('fade-in');
    }

    // 챌린지 요소 생성
    function createChallengeElement(data) {
        const challenge = document.createElement('div');
        challenge.className = 'challenge-item';

        const dateText = formatSelectedDates(data.dates);

        challenge.innerHTML = `
                <div class="challenge-title">${data.title}</div>
                <div class="challenge-description">${data.description || '설명 없음'}</div>
                <div class="challenge-dates">선택된 날짜: ${dateText}</div>
                <div class="challenge-actions">
                    <button class="action-btn edit-btn" onclick="editChallenge(this)">✏️ 수정</button>
                    <button class="action-btn delete-btn" onclick="removeChallenge(this)">🗑️ 삭제</button>
                </div>
            `;

        // 데이터 저장
        challenge.dataset.challengeData = JSON.stringify(data);

        return challenge;
    }

    // 선택된 날짜 포맷팅
    function formatSelectedDates(dates) {
        if (dates.length <= 5) {
            return dates.map(date => {
                const d = new Date(date);
                return `${d.getMonth() + 1}월 ${d.getDate()}일`;
            }).join(', ') + ` (총 ${dates.length}일)`;
        } else {
            const first = new Date(dates[0]);
            const last = new Date(dates[dates.length - 1]);
            return `${first.getMonth() + 1}월 ${first.getDate()}일 ~ ${last.getMonth() + 1}월 ${last.getDate()}일 등 (총 ${dates.length}일)`;
        }
    }

    // 챌린지 수정
    function editChallenge(btn) {
        const challengeItem = btn.closest('.challenge-item');
        const data = JSON.parse(challengeItem.dataset.challengeData);

        // 폼에 데이터 로드
        document.getElementById('title').value = data.title;
        document.getElementById('description').value = data.description;

        // 날짜 선택 복원 (과거 날짜 포함)
        selectedDates.clear();
        data.dates.forEach(date => selectedDates.add(date));
        generateCalendar();
        updateSelectedDatesInfo();

        // 편집 모드 설정
        isEditMode = true;
        editingChallenge = challengeItem;
        document.getElementById('deleteBtn').classList.remove('hidden');

        // 스크롤
        document.querySelector('.form-container').scrollIntoView({behavior: 'smooth'});
    }

    // 챌린지 목록에서 업데이트
    function updateChallengeInList(challengeElement, data) {
        const newElement = createChallengeElement(data);
        challengeElement.replaceWith(newElement);
    }

    // 챌린지 삭제 (편집 모드)
    function deleteChallenge() {
        if (confirm('정말로 이 챌린지를 삭제하시겠습니까?')) {
            editingChallenge.remove();

            // 폼 초기화
            document.getElementById('challengeForm').reset();
            selectedDates.clear();
            generateCalendar();
            updateSelectedDatesInfo();

            isEditMode = false;
            editingChallenge = null;
            document.getElementById('deleteBtn').classList.add('hidden');

            alert('챌린지가 삭제되었습니다.');
        }
    }

    // 챌린지 제거 (목록에서)
    function removeChallenge(btn) {
        if (confirm('정말로 이 챌린지를 삭제하시겠습니까?')) {
            const challengeItem = btn.closest('.challenge-item');
            challengeItem.style.opacity = '0.5';
            setTimeout(() => {
                challengeItem.remove();
            }, 300);
        }
    }
</script>
</body>
</html>